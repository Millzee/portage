--- build.xml.original	2004-03-21 23:38:55.000000000 +0100
+++ build.xml	2006-09-24 23:44:30.000000000 +0200
@@ -145,6 +145,9 @@
         <copy file="forrest.properties" tofile="${build.site.src}/forrest.properties"/>
     </target>
 
+    <target name="init-test" depends="init,check-jars-test,fetch-jars-test">
+    </target>
+
     <target name="clean">
         <delete dir="build"/>
     </target>
@@ -160,13 +163,24 @@
               	<available file="${contrib.jar3.dir}"/>
               	<available file="${contrib.jar4.dir}"/>
               	<available file="${contrib.jar5.dir}"/>
-               	<available file="${junit.jar1.dir}"/>
             </and>
 			<isset property="disconnected"/>
 	    </or>
         </condition>
     </target>
 
+    <target name="check-jars-test">
+        <condition property="test.jars.present">
+            <or>
+            <and>
+                <available file="${junit.jar1.dir}"/>
+            </and>
+                        <isset property="disconnected"/>
+            </or>
+        </condition>
+    </target>
+
+
     <target name="fetch-jars" unless="jars.present">
         <get src="${main.jar1.url}" dest="${main.jar1.dir}"/>
         <get src="${main.jar2.url}" dest="${main.jar2.dir}"/>
@@ -178,6 +192,10 @@
         <get src="${junit.jar1.url}" dest="${junit.jar1.dir}"/>
     </target>
 
+    <target name="fetch-jars-test" unless="test.jars.present">
+        <get src="${junit.jar1.url}" dest="${junit.jar1.dir}"/>
+    </target>
+
     <target name="compile" depends="init,compile-main,compile-scratchpad,compile-contrib">
 
     </target>
@@ -240,7 +258,7 @@
                 <pathelement location="${main.output.test.dir}"/>
                 <pathelement location="${junit.jar1.dir}"/>
          </path>
-    <target name="test-main" depends="compile-main,-test-main-check" unless="main.test.notRequired">
+    <target name="test-main" depends="init-test,compile-main,-test-main-check" unless="main.test.notRequired">
         <junit printsummary="yes" showoutput="true" filtertrace="no" fork="no"
             haltonfailure="${halt.on.test.failure}" failureproperty="main.test.failed">
             <classpath refid="test.classpath"/>
@@ -260,7 +278,7 @@
         <antcall target="-test-main-write-testfile"/>
     </target>
 
-    <target name="single-test" depends="-test-property-check,compile-main">
+    <target name="single-test" depends="-test-property-check,init-test,compile-main">
 	<junit printsummary="no" showoutput="true" filtertrace="no" haltonfailure="${halt.on.test.failure}" failureproperty="main.test.failed" >
             <classpath refid="test.classpath"/>
 	    <sysproperty key="HSSF.testdata.path" value="${main.src.test}/org/apache/poi/hssf/data"/>
@@ -272,7 +290,7 @@
 	</junit>
     </target>
 
-    <target name="debug-test" depends="-test-property-check,compile-main">
+    <target name="debug-test" depends="-test-property-check,init-test,compile-main">
 	<junit printsummary="no" showoutput="true" filtertrace="no" fork="yes" haltonfailure="${halt.on.test.failure}" failureproperty="main.test.failed" >
 	<jvmarg value="-Xdebug"/>
 	<jvmarg value="-Xrunjdwp:transport=dt_socket,address=5001,server=y,suspend=y"/>
@@ -338,7 +356,7 @@
         </uptodate>
     </target>
 
-    <target name="test-contrib" depends="compile-contrib,-test-contrib-check" unless="contrib.test.notRequired">
+    <target name="test-contrib" depends="init-test,compile-contrib,-test-contrib-check" unless="contrib.test.notRequired">
         <junit printsummary="yes" fork="no" haltonfailure="${halt.on.test.failure}">
             <classpath>
                 <path refid="contrib.classpath"/>

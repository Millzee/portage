--- fop.orig	2007-01-20 21:04:08.000000000 +0100
+++ fop	2007-01-20 21:05:30.000000000 +0100
@@ -122,19 +122,7 @@
 fi
 
 if [ -z "$JAVACMD" ] ; then
-  if [ -n "$JAVA_HOME"  ] ; then
-    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
-      # IBM's JDK on AIX uses strange locations for the executables
-      JAVACMD="$JAVA_HOME/jre/sh/java"
-    else
-      JAVACMD="$JAVA_HOME/bin/java"
-    fi
-  else
-    JAVACMD=`which java 2> /dev/null `
-    if [ -z "$JAVACMD" ] ; then
-        JAVACMD=java
-    fi
-  fi
+	JAVACMD=`java-config -J`
 fi
 
 if [ ! -x "$JAVACMD" ] ; then
@@ -147,29 +135,11 @@
   LOCALCLASSPATH=$CLASSPATH
 fi
 
-# add fop.jar, fop-sandbox and fop-hyph.jar, which reside in $FOP_HOME/build
-LOCALCLASSPATH=${FOP_HOME}/build/fop.jar${pathSepChar}${FOP_HOME}/build/fop-sandbox.jar${pathSepChar}${FOP_HOME}/build/fop-hyph.jar${pathSepChar}$LOCALCLASSPATH
-
-# add in the dependency .jar files, which reside in $FOP_HOME/lib
-DIRLIBS=${FOP_HOME}/lib/*.jar
-for i in ${DIRLIBS}
-do
-    # if the directory is empty, then it will return the input string
-    # this is stupid, so case for it
-    if [ "$i" != "${DIRLIBS}" ] ; then
-      if [ -z "$LOCALCLASSPATH" ] ; then
-        LOCALCLASSPATH=$i
-      else
-        LOCALCLASSPATH="$i"${pathSepChar}$LOCALCLASSPATH
-      fi
-    fi
-done
-
 # add in user-defined hyphenation JARs
 if [ -n "$FOP_HYPHENATION_PATH" ] ; then
   LOCALCLASSPATH=$LOCALCLASSPATH${pathSepChar}$FOP_HYPHENATION_PATH
 fi
-
+LOCALCLASSPATH=`java-config -p commons-io-1,commons-logging,avalon-framework-4.2,fop`:$LOCALCLASSPATH 2> /dev/null
 # For Cygwin, switch paths to appropriate format before running java
 # For PATHs convert to unix format first, then to windows format to ensure
 # both formats are supported. Probably this will fail on directories with ;
